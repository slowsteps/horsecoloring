package  {		import flash.events.MouseEvent;	import flash.events.TouchEvent;	import flash.ui.Multitouch;	import flash.ui.MultitouchInputMode;	import flash.events.Event;	import flash.events.ErrorEvent	import flash.events.IOErrorEvent	import flash.display.MovieClip;	import flash.events.Event;	import com.greensock.TweenLite;	import com.greensock.TweenMax;	import com.greensock.*;	import com.greensock.easing.*;	import flash.media.Sound	import flash.net.URLLoader	import flash.net.URLRequest	import flash.net.navigateToURL	import flash.desktop.NativeApplication	import flash.display.Loader;						public class Mainmenu extends MovieClip {				var mymain:Main		var achievementslist		var thumbs:Array		var restore:MovieClip		public var inappManager:InappManager								public function Mainmenu(inMain) {			trace("main menu")			mymain = inMain			this.background.width = this.mymain.stage.fullScreenWidth			this.background.height = this.mymain.stage.fullScreenHeight			showDrawingPreviews()			//debug buttons			this.clearcookiebutton.visible = true			this.testbuybutton.visible = true			//end debug			this.clearcookiebutton.addEventListener(MouseEvent.CLICK,clearCookie)			this.testbuybutton.addEventListener(MouseEvent.CLICK,onTestBuy)			addEventListener("inappcancelled",onCancel) 						if (!mymain.payingUser) {				restore = new RestoreButton()				addChild(restore)				restore.scaleX =  mymain.stage.fullScreenWidth / mymain.gameWidth				restore.scaleY =  mymain.stage.fullScreenHeight / mymain.gameHeight				restore.x = 0.5*mymain.stage.fullScreenWidth				restore.y = 0.95*mymain.stage.fullScreenHeight				restore.addEventListener(MouseEvent.CLICK,this.onRestorePurchase)				mymain.dispatcher.addEventListener(CustomEvent.ON_INAPP_CANCELLED,onRestoreCancel)				mymain.dispatcher.addEventListener(CustomEvent.ON_INAPP_BUY,onPaid)				mymain.dispatcher.addEventListener(CustomEvent.ON_BUY_CLICKED,onIAPBusy)			}						new Promo(this)											}						private function onTestBuy(e) {			mymain.dispatcher.dispatchEvent(new CustomEvent(CustomEvent.ON_INAPP_BUY))		}					private function onCancel(e:Event) {			trace("cancel received in mainmenu")			restore.addEventListener(MouseEvent.CLICK,this.onRestorePurchase)			restore.alpha = 1.0		}		private function onIAPBusy(e:Event) {			restore.alpha = 0.5			restore.removeEventListener(MouseEvent.CLICK,this.onRestorePurchase)		}					private function clearCookie(e:Event) {			mymain.cookie.clear()			mymain.alert("Cookie cleared",Message.ICON_LOADING)					}						private function onRestorePurchase(e:Event) {			restore.removeEventListener(MouseEvent.CLICK,this.onRestorePurchase)			restore.alpha=0.5			mymain.alert("please wait")			this.inappManager = new InappManager(this.mymain,"restore")						TweenMax.to(restore,0.3,{alpha:0.5,yoyo:true,repeat:-1,overwrite:false})		}				private function onRestoreCancel(e:Event) {			restore.addEventListener(MouseEvent.CLICK,this.onRestorePurchase)			restore.alpha=1.0			//mymain.alert("cancelled")			TweenMax.to(restore,0.3,{alpha:1.0,yoyo:false,overwrite:true})		}						private function onPaid(e:Event) {			restore.visible = false		}				//make array of drawings, loop though them and display,				private function showDrawingPreviews() {			thumbs = new Array() 			var thumb:Thumbnail 			thumb = new Thumbnail(this,mymain,new Horsedrawing(),0,new IconHorse(),"horse")			thumb.openSound = new HorseSound()			addChild(thumb)			thumbs.push(thumb)			thumb = new Thumbnail(this,mymain,new Unicorndrawing(),4,new IconUnicorn(),"unicorn")			thumb.openSound = new UnicornSound()			addChild(thumb)			thumbs.push(thumb)			thumb = new Thumbnail(this,mymain,new Stabledrawing(),1,new IconStable(),"stable")			thumb.openSound = new StableSound()			addChild(thumb)			thumbs.push(thumb)						thumb = new Thumbnail(this,mymain,new Crocodiledrawing(),2,new IconCrocodile(),"crocodile")			thumb.openSound = new CrocodileSound()			addChild(thumb)			thumbs.push(thumb)						thumb = new Thumbnail(this,mymain,new Dolphindrawing(),3,new IconDolphin(),"dolphin")			thumb.openSound = new DolphinSound()			addChild(thumb)			thumbs.push(thumb)						thumb = new Thumbnail(this,mymain,new Giraffedrawing(),5,new IconGiraffe(),"giraffe")			thumb.openSound = new GiraffeSound()			addChild(thumb)			thumbs.push(thumb)						//distribute thumbs												thumbs[0].x = 0.2*mymain.stage.fullScreenWidth - thumbs[0].width/2			thumbs[1].x = 0.5*mymain.stage.fullScreenWidth - thumbs[0].width/2			thumbs[2].x = 0.8*mymain.stage.fullScreenWidth - thumbs[0].width/2						thumbs[0].y = 0.3*mymain.stage.fullScreenHeight - thumbs[0].height/2			thumbs[1].y = 0.3*mymain.stage.fullScreenHeight - thumbs[0].height/2			thumbs[2].y = 0.3*mymain.stage.fullScreenHeight - thumbs[0].height/2									thumbs[3].x = 0.2*mymain.stage.fullScreenWidth - thumbs[0].width/2			thumbs[4].x = 0.5*mymain.stage.fullScreenWidth - thumbs[0].width/2			thumbs[5].x = 0.8*mymain.stage.fullScreenWidth - thumbs[0].width/2						thumbs[3].y = 0.7*mymain.stage.fullScreenHeight - thumbs[0].height/2			thumbs[4].y = 0.7*mymain.stage.fullScreenHeight - thumbs[0].height/2			thumbs[5].y = 0.7*mymain.stage.fullScreenHeight - thumbs[0].height/2													}						public function show(inMode:String=null) {			x=-mymain.gameWidth			visible = true			mymain.gameState = "mainmenu"			if (inMode == "direct") x=0			if (inMode == "animated") TweenLite.to(this, 0.5, {x:0, ease:Cubic.easeInOut});						if (mymain.songChannel) mymain.songChannel.stop()			if (mymain.natureSongChannel) mymain.natureSongChannel.stop()			mymain.songChannel = mymain.coloringSongSound.play()		}								public function hide() {			TweenLite.to(this, 0.5, {x:-this.width,  ease:Cubic.easeInOut, onComplete:toggleVisibility});						mymain.gameState = "coloring"		}				private function toggleVisibility() {			this.visible = false		}		private function toggleAchievementsList(e:Event) {			if (achievementslist.visible == false ) {				achievementslist.visible = true			}			else achievementslist.visible = false		}		private function toggleConsole(e:Event) {			if (mymain.console.mytextfield.visible == false ) {				mymain.console.mytextfield.visible = true			}			else mymain.console.mytextfield.visible = false		}		private function clearConsole(e:Event) {			mymain.console.mytextfield.text = "cleared"		}					}	}
package  {				import flash.net.SharedObject;	import flash.display.MovieClip;	import com.greensock.TweenMax;	import com.greensock.*;	import com.greensock.easing.*;	public class AchievementManager {		private var mymain:Main		private var achievements:Array		private var metrics:Array		public var cookie:SharedObject; 		private var msg:MovieClip				public function AchievementManager(inmain) {			mymain = inmain			createMessage()			loadData()		}		private function createMessage() {			msg = new Message() as MovieClip			mymain.addChild(msg)			msg.x = mymain.gameWidth / 2 - msg.width/2			msg.y = -msg.height			showMessage("hoi!")					}				private function showMessage(str:String="") {			msg.textfield.text = str			var timeline:TimelineLite = new TimelineLite();			timeline.append( new TweenLite(msg, 1, {y:mymain.padding, ease:Elastic.easeOut}) );			timeline.append( new TweenLite(msg, 1, {y:-msg.height, ease:Elastic.easeOut, delay:2}) );		}		private function loadData() {			cookie = SharedObject.getLocal("achievementManager");			//cookie.clear();			trace(cookie,cookie.size,cookie.data.achievements)						if (cookie.data.achievements == null) achievements = new Array()			else (achievements = cookie.data.achievements)						if (cookie.data.metrics == null) metrics = new Array()			else (metrics = cookie.data.metrics)														}		//display a full list of unlocked achievements		public function getAchievementsList() {			var achievementlist:String = "Achievements unlocked:" 			var count:Number=0			for (var key:Object in achievements) {				achievementlist = achievementlist + "\n - " + key				count++			}							return (count + " " + achievementlist)							}		//deal with generated events		public function track(obj) {			//trace("tracking",obj.type)			//color painted			if (obj.type == "colorpaint") {				this.incrementMetric("colorpaints")								this.incrementMetric(obj.colorname)										}			//pattern painted			if (obj.type == "patternpaint") {				this.incrementMetric("patternpaints")								this.incrementMetric(obj.patternname)										}			//colors of the objects (e.g. sky)			if (obj.type == "objectcolors") {				checkForColorCombi(obj)			}			//something with time and date									//store metrics			cookie.data.metrics = metrics			//find out if any new achievements have been unlocked			checkForAchievements()					}				private function checkForColorCombi(obj) {			//available objects: sky, ground,tail,manes,tuft,body			//simple			if (obj.colors.sky == "blue") saveAchievement("mr blue sky") 			if (obj.colors.sky == "black") saveAchievement("horse at night") 			if (obj.colors.sky == "red") saveAchievement("red sky") 			//combi of two			var c = obj.colors			if (c.sky == "black" && c.ground == "white") saveAchievement("polar night") 			if (c.sky == "light blue" && c.ground == "light brown") saveAchievement("desert horse") 			if (c.body == "black" && c.tail == "black" && c.tuft == "black" && c.manes == "black" && c.backleg == "black") saveAchievement("the goth") 			if (c.body == "pink") saveAchievement("girly horse")		}						//achievement rules		private function checkForAchievements() {			//total colors painted			if (metrics["colorpaints"] == 1) saveAchievement("baby painter") 			if (metrics["colorpaints"] == 5) saveAchievement("apprentice painter") 			if (metrics["colorpaints"] == 10) saveAchievement("junior painter") 			if (metrics["colorpaints"] == 20) saveAchievement("medior painter") 			//individual colors painted			if (metrics["red"] == 1) saveAchievement("red discovered") 			if (metrics["blue"] == 1) saveAchievement("blue discovered") 			if (metrics["brown"] == 1) saveAchievement("pink discovered") 			if (metrics["pink"] == 1) saveAchievement("pink discovered") 			if (metrics["orange"] == 1) saveAchievement("pink discovered") 			if (metrics["brown"] == 1) saveAchievement("pink discovered") 			if (metrics["black"] == 1) saveAchievement("pink discovered") 			if (metrics["white"] == 1) saveAchievement("pink discovered") 			if (metrics["blond"] == 1) saveAchievement("pink discovered") 			if (metrics["purple"] == 1) saveAchievement("pink discovered") 			if (metrics["green"] == 1) saveAchievement("pink discovered") 			//stamps placed			if (metrics["flower"] == 10) saveAchievement("10 flowers") 			if (metrics["heart"] == 10) saveAchievement("10 hearts") 			if (metrics["star"] == 10) saveAchievement("10 stars") 			if (metrics["paws"] == 10) saveAchievement("1o paws") 			if (metrics["butterfly"] == 10) saveAchievement("10 butterflies") 			if (metrics["brush"] == 10) saveAchievement("10 butterflies") 						//combination of colors used			//	polar horse, polar horse at night				//-> create array of hitzone points, create mapping off hex colors to colornames				//-> check after every colorpaint: if horsecolor == black and skycolor==blue..			//date and time		}						//check for new achievements		private function saveAchievement(achievementTitle:String) {						if (achievements[achievementTitle] == null)	{				achievements[achievementTitle] = 1								//store				cookie.data.achievements = achievements				cookie.flush()								displayAchievement(achievementTitle)							}						//for (var key:Object in achievements) trace(key,achievements[key])					}				//visual reward		private function displayAchievement(achievementTitle) {			trace(achievementTitle, "unlocked")			this.showMessage(achievementTitle + " unlocked")								}								//utility singleton for metrics		private function incrementMetric(metric) {			if (metric == undefined) trace("Undefined metric")			if (metrics[metric] == null) metrics[metric] = 1			else metrics[metric]++					}			}	}